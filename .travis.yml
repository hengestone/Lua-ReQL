env:
  global:
    - LUAROCKS_BASE=luarocks-2.2.0
  matrix:
    - LUA=lua5.1 LUA_DEV=liblua5.1-dev
    - LUA=lua5.2 LUA_DEV=liblua5.2-dev

install:
  - 'source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list'
  - 'wget -qO- http://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -'
  - 'sudo apt-get update'
  - 'sudo apt-get install $LUA $LUA_DEV rethinkdb'
  - rethinkdb --daemon
  - wget http://luarocks.org/releases/$LUAROCKS_BASE.tar.gz
  - tar zxvpf $LUAROCKS_BASE.tar.gz
  - cd $LUAROCKS_BASE
  - ./configure
  - make build
  - sudo make install
  - sudo make bootstrap
  - sudo luarocks install luasocket
  - sudo luarocks install luajson
  - sudo luarocks install dkjson
  - sudo luarocks install busted
  - cd $TRAVIS_BUILD_DIR

script:
  - busted
